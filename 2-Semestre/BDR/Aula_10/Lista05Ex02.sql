CREATE TABLE Alunos(
    MAT INT NOT NULL,
    nome VARCHAR(40),
    endereco VARCHAR(40),
    cidade VARCHAR(40),
    PRIMARY KEY(MAT)
);

 

CREATE TABLE Disciplinas(
    COD_DISC VARCHAR(50) NOT NULL,
    nome_disc VARCHAR(40),
    carga_hor VARCHAR(20),
    PRIMARY KEY(COD_DISC)
);




CREATE TABLE Professores(
    COD_PROF INT NOT NULL,
    nome VARCHAR(40),
    endereco VARCHAR(40),
    cidade VARCHAR(40),
    PRIMARY KEY(COD_PROF)
);




CREATE TABLE Turma(
    COD_TURMA INT NOT NULL,
    ANO INT NOT NULL,
    COD_DISC VARCHAR(50) NOT NULL,
    COD_PROF INT NOT NULL,
    HORARIO VARCHAR(50),
    PRIMARY KEY(COD_TURMA),
    FOREIGN KEY (COD_DISC) REFERENCES Disciplinas(COD_DISC),
    FOREIGN KEY (COD_PROF) REFERENCES Professores(COD_PROF)
);




CREATE TABLE Historico (
    MAT INT NOT NULL,
    COD_TURMA INT NOT NULL,
    COD_DISC VARCHAR(50) NOT NULL,
    COD_PROF INT NOT NULL,
    ANO INT,
    Frequencia VARCHAR(4),
    Nota FLOAT,
    FOREIGN KEY (MAT) REFERENCES Alunos(MAT),
    FOREIGN KEY (COD_PROF) REFERENCES Professores(COD_PROF),
    FOREIGN KEY (COD_DISC) REFERENCES Disciplinas(COD_DISC),
    FOREIGN KEY (COD_Turma) REFERENCES Turma(COD_Turma)
);

INSERT INTO Alunos VALUES

(2015010101, 'JOSE DE ALENCAR', 'RUA DAS ALMAS', 'NATAL'),

(2015010102, 'JOÃO JOSÉ', 'AVENIDA RUY CARNEIRO', 'JOÃO PESSOA'),

(2015010103, 'MARIA JOAQUINA', 'RUA CARROSSEL', 'RECIFE'),

(2015010104, 'MARIA DAS DORES', 'RUA DAS LADEIRAS', 'FORTALEZA'),

(2015010105, 'JOSUÉ CLAUDINO DOS SANTOS', 'CENTRO', 'NATAL'),

(2015010106, 'JOSUÉLISSON CLAUDINO DOS SANTOS', 'CENTRO', 'NATAL');




INSERT INTO Disciplinas VALUES

('BD', 'BANCO DE DADOS', 100),

('POO', 'PROGRAMAÇÃO COM ACESSO A BANCO DE DADOS', 100),

('WEB', 'AUTORIA WEB', 50),

('ENG', 'ENGENHARIA DE SOFTWARE', 80);




INSERT INTO Professores (COD_PROF, nome, endereco, cidade) VALUES

(212131, 'NICKERSON FERREIRA', 'RUA MANAÍRA', 'JOÃO PESSOA'),

(122135, 'ADORILSON BEZERRA', 'AVENIDA SALGADO FILHO', 'NATAL'),

(192011, 'DIEGO OLIVEIRA', 'AVENIDA ROBERTO FREIRE', 'NATAL');




INSERT INTO Turma VALUES

(1, 2015, 'BD', 212131, '11H-12H'),

(2, 2015, 'BD', 212131, '13H-14H'),

(3, 2015, 'POO', 192011, '08H-09H'),

(4, 2015, 'WEB', 192011, '07H-08H'),

(5, 2015, 'ENG', 122135, '10H-11H');




INSERT INTO Historico VALUES 

(2015010101, 1, 'BD', 192011, 2015, '20', 10.00),

(2015010103, 3, 'POO', 122135, 2015, '9', 8.00),

(2015010106, 4, 'WEB', 212131, 2000, '100', 1.00),

(2015010101, 1, 'POO', 122135, 2019, '24', 07.00),

(2015010104, 1, 'WEB', 192011, 2014, '28', 08.00),

(2015010105, 1, 'ENG', 212131, 2020, '16', 10.00);


-- A

SELECT MAT FROM HISTORICO
WHERE COD_DISC = 'BD' AND ANO = 2015;

-- B

SELECT MAT, AVG(NOTA) AS 'Med' FROM HISTORICO
WHERE COD_DISC = 'POO' AND ANO = 2015
GROUP BY MAT;

-- C

SELECT MAT, AVG(NOTA) AS 'Med' FROM HISTORICO
WHERE COD_DISC = 'POO' 
AND ANO = 2015
GROUP BY MAT
HAVING AVG(NOTA) > 6;

-- D
SELECT * FROM Alunos WHERE NOT (cidade = 'NATAL');
